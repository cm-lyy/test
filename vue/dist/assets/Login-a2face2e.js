/* empty css             *//* empty css                  *//* empty css                *//* empty css                     */import{r as u}from"./request-4a7e5a78.js";/* empty css               *//* empty css                  */import{_ as C}from"./login-left-qte69_UC-b0eb4b47.js";import{_ as S,I as m,r as N,aa as k,o as L,c as M,g as a,d as s,w as l,E as c,J as R,u as y,k as w,G as z,H as T,a as x,Z as q,L as F,M as O,a1 as j,a2 as $,a0 as A,s as J,ab as G,ac as H}from"./index-b4448272.js";/* empty css                    *//* empty css                */const f=p=>(z("data-v-9147c996"),p=p(),T(),p),P={class:"login-container"},Z={class:"login-boxOne",style:{display:"flex"}},K=f(()=>a("div",null,[a("img",{class:"login-image",src:C,alt:"login"})],-1)),Q={class:"login-boxTwo"},W=f(()=>a("div",{class:"login-title"}," 农 产 品 销 售 管 理 系 统 ",-1)),X={style:{display:"flex"}},Y=f(()=>a("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[a("div",null,[a("a",{href:"/ForgotPassword"},"忘记账号或密码？")]),a("div",null,[w(" 如没有账号？请 "),a("a",{href:"/register"},"注册")])],-1)),D={__name:"Login",setup(p){const _=m(""),g=m(!1),h=m(null),d=async()=>{try{g.value=!0;const o=await u.get("/Captcha/image",{responseType:"blob"});o&&o.data instanceof Blob?_.value=URL.createObjectURL(o.data):c.error("验证码获取失败，返回的数据格式错误")}catch(o){o.response?o.response.status===429?c.error("请求过于频繁，请稍后再试"):c.error(`验证码获取失败，状态码: ${o.response.status}`):c.error(`验证码获取失败，请稍后重试。错误信息: ${o.message}`)}finally{g.value=!1}},t=N({form:{username:"",password:"",captcha:"",role:"ADMIN"},rules:{username:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"},{validator:async(o,e,n)=>{try{const r=await u.post("/Captcha/validate",{captcha:e});r.success?n():(n(new Error(r.msg||"验证码错误")),c.error("验证码都输入不对，跳楼吧"))}catch{n(new Error("验证码验证失败，请重试"))}},trigger:"blur"}]}}),E=()=>{h.value.validate(o=>{o&&u.post("/login",t.form).then(e=>{e.code==="200"?(c.success("登录成功"),localStorage.setItem("system-user",JSON.stringify(e.data)),x.push("/"),console.log(t.form.role),t.form.role==="USER"&&V(e.data)):c.error(e.msg)}).catch(e=>{console.error(e),d()})})},V=o=>{let e=[];o.email||e.push("邮箱"),o.sex||e.push("性别"),o.phoneNumber||e.push("手机号"),o.avatar||e.push("头像"),e.length>0&&q.confirm(`您的以下信息未填写：${e.join("，")}，请完善个人信息。`,"提示",{confirmButtonText:"去修改",cancelButtonText:"稍后",type:"warning"}).then(()=>{x.push("/person")}).catch(()=>{})};return k(()=>{d()}),(o,e)=>{const n=F,r=O,v=j,b=$,I=A,U=J,B=R;return L(),M("div",P,[a("div",Z,[K,a("div",Q,[W,s(B,{model:t.form,ref_key:"formRef",ref:h,rules:t.rules},{default:l(()=>[s(r,{prop:"username"},{default:l(()=>[s(n,{"prefix-icon":y(G),size:"large",modelValue:t.form.username,"onUpdate:modelValue":e[0]||(e[0]=i=>t.form.username=i),placeholder:"请输入账号"},null,8,["prefix-icon","modelValue"])]),_:1}),s(r,{prop:"password"},{default:l(()=>[s(n,{"prefix-icon":y(H),size:"large",modelValue:t.form.password,"onUpdate:modelValue":e[1]||(e[1]=i=>t.form.password=i),placeholder:"请输入密码","show-password":""},null,8,["prefix-icon","modelValue"])]),_:1}),s(r,{prop:"role"},{default:l(()=>[s(b,{size:"large",style:{width:"100%"},modelValue:t.form.role,"onUpdate:modelValue":e[2]||(e[2]=i=>t.form.role=i)},{default:l(()=>[s(v,{value:"ADMIN",label:"管理员"}),s(v,{value:"USER",label:"普通用户"})]),_:1},8,["modelValue"])]),_:1}),s(r,{prop:"captcha"},{default:l(()=>[a("div",X,[s(n,{size:"large",modelValue:t.form.captcha,"onUpdate:modelValue":e[3]||(e[3]=i=>t.form.captcha=i),placeholder:"请输入验证码",style:{flex:"1",width:"158px"}},null,8,["modelValue"]),s(I,{style:{width:"175px",height:"40px","margin-left":"10px"},onClick:d,src:_.value,fit:"contain"},null,8,["src"])])]),_:1}),s(r,null,{default:l(()=>[s(U,{size:"large",type:"primary",style:{width:"100%","margin-top":"2%"},onClick:E},{default:l(()=>[w("登 录")]),_:1})]),_:1})]),_:1},8,["model","rules"]),Y])])])}}},ue=S(D,[["__scopeId","data-v-9147c996"]]);export{ue as default};
