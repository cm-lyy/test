/* empty css             *//* empty css                  *//* empty css                *//* empty css                     */import{r as c}from"./request-4a7e5a78.js";import{_ as $}from"./login-left-qte69_UC-b0eb4b47.js";import{_ as k,I as u,r as A,aa as F,o as L,c as M,g as d,d as s,w as i,E as n,J as T,u as f,k as b,t as Z,G as D,H as O,a as j,L as G,M as H,a0 as J,s as K,ab as Q,ac as N,ad as W,ae as X}from"./index-b4448272.js";const x=g=>(D("data-v-6232b5a1"),g=g(),O(),g),Y={class:"register-container"},ee={class:"register-boxOne"},re=x(()=>d("div",null,[d("img",{class:"register-image",src:$,alt:"register"})],-1)),se={class:"register-boxTwo"},ae=x(()=>d("div",{class:"register-title"}," 欢 迎 注 册 ",-1)),oe={style:{display:"flex"}},te={style:{display:"flex"}},le=x(()=>d("div",{style:{"text-align":"right"}},[b(" 已有账号？请 "),d("a",{href:"/login"},"登录")],-1)),ie={__name:"Register",setup(g){const S=(o,e,a)=>{e!==r.form.password?a(new Error("密码和确认密码不一致")):a()},y=u(""),V=u(!1),m=u(0),v=u(!1),_=u(!1),C=u(null),h=u(null),I=()=>{m.value=60,v.value=!0,C.value=setInterval(()=>{m.value>0?m.value-=1:(clearInterval(C.value),v.value=!1)},1e3)},E=async()=>{try{V.value=!0;const o=await c.get("/Captcha/image",{responseType:"blob"});o&&o.data instanceof Blob?y.value=URL.createObjectURL(o.data):n.error("验证码获取失败，返回的数据格式错误")}catch(o){o.response?o.response.status===429?n.error("请求过于频繁，请稍后再试"):n.error(`验证码获取失败，状态码: ${o.response.status}`):n.error(`验证码获取失败，请稍后重试。错误信息: ${o.message}`)}finally{V.value=!1}},U=async(o,e,a)=>{try{const t=await c.post("/Captcha/validate",{captcha:e});t.success?a():a(new Error(t.msg||"验证码错误"))}catch{a(new Error("验证码验证失败，请重试"))}},q=async()=>{m.value>0||_.value||(_.value=!0,h.value.validateField(["username","password","confirmPassword","captcha","email"],async o=>{if(o)try{const e=await c.post("/Sms/Sender",{phoneNumber:r.form.phoneNumber});e.success?(n.success("验证码发送成功"),I()):n.error(e.message||"验证码发送失败")}catch{n.error("验证码请求失败，请稍后重试")}finally{_.value=!1}else n.error("请先填写完整的账号、密码和图片验证码"),_.value=!1}))},w=u(!1),r=A({form:{username:"",password:"",confirmPassword:"",email:"",phoneNumber:"",captcha:"",smsCode:""},rules:{username:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请输入确认密码",trigger:"blur"},{validator:S,trigger:"blur"}],phoneNumber:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入有效的手机号码",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/,message:"请输入有效的邮箱地址",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"},{validator:U,trigger:"blur"}],smsCode:[{required:!0,message:"请输入手机验证码",trigger:"submit"},{validator:async(o,e,a)=>{if(!w.value){w.value=!0;try{const t=await c.post("/Sms/Verify",{smsCode:e,phoneNumber:r.form.phoneNumber});t.success?a():a(new Error(t.message||"手机验证码错误"))}catch{a(new Error("手机验证码验证失败，请重试"))}finally{w.value=!1}}},trigger:"submit"}]}}),p=u(!1),R=()=>{p.value||(p.value=!0,h.value.validate(o=>{o?c.post("/register",r.form).then(e=>{p.value=!1,e.code==="200"?(n.success("注册成功"),j.push("/login")):n.error(e.msg)}).catch(()=>{p.value=!1}):p.value=!1}))};return F(()=>{E()}),(o,e)=>{const a=G,t=H,P=J,z=K,B=T;return L(),M("div",Y,[d("div",ee,[re,d("div",se,[ae,s(B,{model:r.form,ref_key:"formRef",ref:h,rules:r.rules},{default:i(()=>[s(t,{prop:"username"},{default:i(()=>[s(a,{"prefix-icon":f(Q),size:"large",modelValue:r.form.username,"onUpdate:modelValue":e[0]||(e[0]=l=>r.form.username=l),placeholder:"请输入账号"},null,8,["prefix-icon","modelValue"])]),_:1}),s(t,{prop:"password"},{default:i(()=>[s(a,{"prefix-icon":f(N),size:"large",modelValue:r.form.password,"onUpdate:modelValue":e[1]||(e[1]=l=>r.form.password=l),placeholder:"请输入密码","show-password":""},null,8,["prefix-icon","modelValue"])]),_:1}),s(t,{prop:"confirmPassword"},{default:i(()=>[s(a,{"prefix-icon":f(N),size:"large",modelValue:r.form.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=l=>r.form.confirmPassword=l),placeholder:"请输入确认密码","show-password":""},null,8,["prefix-icon","modelValue"])]),_:1}),s(t,{prop:"email"},{default:i(()=>[s(a,{"prefix-icon":f(W),size:"large",modelValue:r.form.email,"onUpdate:modelValue":e[3]||(e[3]=l=>r.form.email=l),placeholder:"请输入邮箱"},null,8,["prefix-icon","modelValue"])]),_:1}),s(t,{prop:"phoneNumber"},{default:i(()=>[s(a,{"prefix-icon":f(X),size:"large",modelValue:r.form.phoneNumber,"onUpdate:modelValue":e[4]||(e[4]=l=>r.form.phoneNumber=l),placeholder:"请输入手机号"},null,8,["prefix-icon","modelValue"])]),_:1}),s(t,{prop:"captcha"},{default:i(()=>[d("div",oe,[s(a,{size:"large",modelValue:r.form.captcha,"onUpdate:modelValue":e[5]||(e[5]=l=>r.form.captcha=l),placeholder:"请输入验证码",style:{flex:"1",width:"150px"}},null,8,["modelValue"]),s(P,{style:{width:"175px",height:"40px","margin-left":"10px"},onClick:E,src:y.value,fit:"contain"},null,8,["src"])])]),_:1}),s(t,{prop:"smsCode"},{default:i(()=>[d("div",te,[s(a,{size:"large",modelValue:r.form.smsCode,"onUpdate:modelValue":e[6]||(e[6]=l=>r.form.smsCode=l),placeholder:"请输入手机验证码",style:{flex:"1",width:"150px"}},null,8,["modelValue"]),s(z,{size:"large",style:{"margin-left":"10px",width:"175px"},disabled:v.value,onClick:q},{default:i(()=>[b(Z(m.value>0?m.value+"秒":"获取手机验证码"),1)]),_:1},8,["disabled"])])]),_:1}),s(t,null,{default:i(()=>[s(z,{size:"large",type:"primary",style:{width:"100%","margin-top":"2%"},onClick:R},{default:i(()=>[b("注册")]),_:1})]),_:1})]),_:1},8,["model","rules"]),le])])])}}},_e=k(ie,[["__scopeId","data-v-6232b5a1"]]);export{_e as default};
