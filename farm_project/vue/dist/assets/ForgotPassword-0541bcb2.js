/* empty css             *//* empty css                  *//* empty css                *//* empty css                     */import{r as c}from"./request-4a7e5a78.js";import{_ as R}from"./login-left-qte69_UC-b0eb4b47.js";import{_ as k,I as d,r as L,aa as M,o as T,c as $,g as l,d as o,w as i,E as u,J as j,u as _,k as y,t as D,G as O,H as G,a as H,L as J,M as A,a0 as K,s as Q,ab as W,ac as S,ae as X}from"./index-b4448272.js";const x=f=>(O("data-v-157c8c35"),f=f(),G(),f),Y={class:"register-container"},Z={class:"register-boxOne"},ee=x(()=>l("div",null,[l("img",{class:"register-image",src:R,alt:"login"})],-1)),se={class:"register-boxTwo"},re=x(()=>l("div",{class:"register-title"}," 找 回 密 码 ",-1)),oe={style:{display:"flex"}},ae={style:{display:"flex"}},te=x(()=>l("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[l("div",null,[l("a",{href:"/ForgotUsername"},"忘记账号？")]),l("div",null,[y(" 想起来了？请 "),l("a",{href:"/login"},"登录")])],-1)),le={__name:"ForgotPassword",setup(f){const P=(a,e,r)=>{e!==s.form.password?r(new Error("密码和确认密码不一致")):r()},b=d(""),V=d(!1),m=d(0),v=d(!1),g=d(!1),C=d(null),h=d(null),I=()=>{m.value=60,v.value=!0,C.value=setInterval(()=>{m.value>0?m.value-=1:(clearInterval(C.value),v.value=!1)},1e3)},E=async()=>{try{V.value=!0;const a=await c.get("/Captcha/image",{responseType:"blob"});a&&a.data instanceof Blob?b.value=URL.createObjectURL(a.data):u.error("验证码获取失败，返回的数据格式错误")}catch(a){a.response?a.response.status===429?u.error("请求过于频繁，请稍后再试"):u.error(`验证码获取失败，状态码: ${a.response.status}`):u.error(`验证码获取失败，请稍后重试。错误信息: ${a.message}`)}finally{V.value=!1}},U=async(a,e,r)=>{try{const t=await c.post("/Captcha/validate",{captcha:e});t.success?r():r(new Error(t.msg||"验证码错误"))}catch{r(new Error("验证码验证失败，请重试"))}},q=async()=>{m.value>0||g.value||(g.value=!0,h.value.validateField(["username","password","confirmPassword","captcha"],async a=>{if(a)try{const e=await c.post("/Sms/Sender",{phoneNumber:s.form.phoneNumber});e.success?(u.success("验证码发送成功"),I()):u.error(e.message||"验证码发送失败")}catch{u.error("验证码请求失败，请稍后重试")}finally{g.value=!1}else u.error("请先填写完整的账号、密码和图片验证码"),g.value=!1}))},w=d(!1),s=L({form:{username:"",password:"",confirmPassword:"",phoneNumber:"",captcha:"",smsCode:""},rules:{username:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请输入确认密码",trigger:"blur"},{validator:P,trigger:"blur"}],phoneNumber:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入有效的手机号码",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"},{validator:U,trigger:"blur"}],smsCode:[{required:!0,message:"请输入手机验证码",trigger:"submit"},{validator:async(a,e,r)=>{if(!w.value){w.value=!0;try{const t=await c.post("/Sms/Verify",{smsCode:e,phoneNumber:s.form.phoneNumber});t.success?r():r(new Error(t.message||"手机验证码错误"))}catch{r(new Error("手机验证码验证失败，请重试"))}finally{w.value=!1}}},trigger:"submit"}]}}),p=d(!1),z=()=>{p.value||(p.value=!0,h.value.validate(a=>{a?c.post("/ForgotPassword",s.form).then(e=>{p.value=!1,e.code==="200"?(u.success("密码重置成功"),H.push("/login")):u.error(e.msg)}).catch(()=>{p.value=!1}):p.value=!1}))};return M(()=>{E()}),(a,e)=>{const r=J,t=A,F=K,N=Q,B=j;return T(),$("div",Y,[l("div",Z,[ee,l("div",se,[re,o(B,{model:s.form,ref_key:"formRef",ref:h,rules:s.rules},{default:i(()=>[o(t,{prop:"username"},{default:i(()=>[o(r,{"prefix-icon":_(W),size:"large",modelValue:s.form.username,"onUpdate:modelValue":e[0]||(e[0]=n=>s.form.username=n),placeholder:"请输入账号"},null,8,["prefix-icon","modelValue"])]),_:1}),o(t,{prop:"password"},{default:i(()=>[o(r,{"prefix-icon":_(S),size:"large",modelValue:s.form.password,"onUpdate:modelValue":e[1]||(e[1]=n=>s.form.password=n),placeholder:"请输入新密码","show-password":""},null,8,["prefix-icon","modelValue"])]),_:1}),o(t,{prop:"confirmPassword"},{default:i(()=>[o(r,{"prefix-icon":_(S),size:"large",modelValue:s.form.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=n=>s.form.confirmPassword=n),placeholder:"请确认新密码","show-password":""},null,8,["prefix-icon","modelValue"])]),_:1}),o(t,{prop:"phoneNumber"},{default:i(()=>[o(r,{"prefix-icon":_(X),size:"large",modelValue:s.form.phoneNumber,"onUpdate:modelValue":e[3]||(e[3]=n=>s.form.phoneNumber=n),placeholder:"请输入手机号"},null,8,["prefix-icon","modelValue"])]),_:1}),o(t,{prop:"captcha"},{default:i(()=>[l("div",oe,[o(r,{size:"large",modelValue:s.form.captcha,"onUpdate:modelValue":e[4]||(e[4]=n=>s.form.captcha=n),placeholder:"请输入验证码",style:{flex:"1",width:"150px"}},null,8,["modelValue"]),o(F,{style:{width:"175px",height:"40px","margin-left":"10px"},onClick:E,src:b.value,fit:"contain"},null,8,["src"])])]),_:1}),o(t,{prop:"smsCode"},{default:i(()=>[l("div",ae,[o(r,{size:"large",modelValue:s.form.smsCode,"onUpdate:modelValue":e[5]||(e[5]=n=>s.form.smsCode=n),placeholder:"请输入手机验证码",style:{flex:"1",width:"150px"}},null,8,["modelValue"]),o(N,{size:"large",style:{"margin-left":"10px",width:"175px"},disabled:v.value,onClick:q},{default:i(()=>[y(D(m.value>0?m.value+"秒":"获取手机验证码"),1)]),_:1},8,["disabled"])])]),_:1}),o(t,null,{default:i(()=>[o(N,{size:"large",type:"primary",style:{width:"100%","margin-top":"2%"},onClick:z},{default:i(()=>[y("重置密码")]),_:1})]),_:1})]),_:1},8,["model","rules"]),te])])])}}},ge=k(le,[["__scopeId","data-v-157c8c35"]]);export{ge as default};
